WITH
OVER_PAR AS (
SELECT TOURNAMENT_NAME, AVG(R4_SCORE - PAR) AS O_PAR_SCORE
FROM PLAYER_TOURNAMENT_RESULTS
WHERE R3_SCORE - PAR > 0
GROUP BY 1
),
UNDER_PAR AS (
SELECT TOURNAMENT_NAME, AVG(R4_SCORE - PAR) AS U_PAR_SCORE
FROM PLAYER_TOURNAMENT_RESULTS
WHERE R3_SCORE - PAR < 0
GROUP BY 1
)

SELECT OVER_PAR.TOURNAMENT_NAME, O_PAR_SCORE, U_PAR_SCORE,
(CASE 
     WHEN UPPER(OVER_PAR.TOURNAMENT_NAME) LIKE "%MASTERS%" THEN 1.0
     WHEN UPPER(OVER_PAR.TOURNAMENT_NAME) LIKE "%U.S. OPEN%" THEN 2.0
     WHEN UPPER(OVER_PAR.TOURNAMENT_NAME) LIKE "%THE OPEN%" THEN 3.0
     WHEN UPPER(OVER_PAR.TOURNAMENT_NAME) LIKE "%PGA%" THEN 4.0
     WHEN UPPER(OVER_PAR.TOURNAMENT_NAME) LIKE "%PLAYERS%" THEN 5.0
  END) AS TOURNAMENT_F
FROM OVER_PAR INNER JOIN UNDER_PAR ON OVER_PAR.TOURNAMENT_NAME = UNDER_PAR.TOURNAMENT_NAME
ORDER BY TOURNAMENT_F
